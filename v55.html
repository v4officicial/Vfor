<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/libi/jquery-3.6.0.min.js"></script>
</head>

<body>
  
</body>
<script>
  



window.addEventListener("load", function() {
  (function() {
  // Create style element with popup CSS
  const style = document.createElement('style');
  style.type = 'text/css';
  style.textContent = `
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    width: 100%;
    height: 100%;
    font-family: Arial, sans-serif;
    overflow-x: hidden;
  }

  /* Overlay background */
  .popup-wrap {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,0.65);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    z-index: 9999;
  }

  /* Popup box centered */
  .popup {
    position: relative;
    background: #000;
    border-radius: 16px;
    width: 90%;
    max-width: 900px;
    height: auto;
    padding: 20px;
    display: flex;
  justify-content: space-around;
    box-shadow: 0 15px 50px rgba(0,0,0,0.7);
  }

  /* Close button */
  .btn-close {
    position: absolute;
    top: 12px; right: 12px;
    width: 32px; height: 32px;
    border-radius: 50%;
    background: #fff;
    color: #000;
    font-size: 1.4rem;
    font-weight: bold;
    line-height: 32px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.3s ease;
    z-index: 999;
  }
  .btn-close:hover { transform: scale(1.1) rotate(90deg); }
  .btn-close.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
    transform: none;
  }

  /* Timer */
  .popup-timer {
    position: absolute;
    top: 12px; right: 60px;
    background: rgba(255,255,255,0.15);
    color: #fff;
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 1.1rem;
    text-align: center;
    min-width: 80px;
    z-index: 999;
  }

  /* Video container centered */
  #video-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    aspect-ratio: 16 / 9;
    border-radius: 12px;
    overflow: hidden;
    margin: 0 auto;
    background-color: #111;
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }

  #content-video,
  #ad-container {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
  }

  #content-video {
    object-fit: contain;
  }

  #ad-container {
    z-index: 20;
    cursor: pointer; 
    pointer-events: none;
    background-color: transparent;
  }

  @media (max-width: 768px) {
    #video-container { aspect-ratio: 4 / 3; }
    .popup-timer { font-size: 1rem; right: 48px; }
    .btn-close { width: 28px; height: 28px; font-size: 1.1rem; }
  }
  `;
  document.head.appendChild(style);
  
  // Create popup HTML structure
  const popupWrap = document.createElement('div');
  popupWrap.className = 'popup-wrap';
  popupWrap.style.display = 'none';
  
  const popup = document.createElement('div');
  popup.className = 'popup';
  
  popup.innerHTML = `
    <div class="popup-timer"><span class="seconds"></span> sec</div>
    <div class="btn-close disabled">Ã—</div>
    <div id="video-container">
      <video id="content-video" controls playsinline poster="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgB4FisStERcFQ-_6PRXKXWkNb71hhxIWX1J3UXFQGWA&s=10">
        <source src="/main_Resource/ads/video ads/The_Bread_-_Animated_Short_Film_by_GULU(360p).mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div id="ad-container"></div>
    </div>
  `;
  
  popupWrap.appendChild(popup);
  document.body.appendChild(popupWrap);
  
  // Load required external scripts dynamically
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const s = document.createElement('script');
      s.src = src;
      s.onload = resolve;
      s.onerror = reject;
      document.head.appendChild(s);
    });
  }
  
  Promise.all([
    loadScript('https://code.jquery.com/jquery-3.7.1.min.js'),
    loadScript('https://imasdk.googleapis.com/js/sdkloader/ima3.js')
  ]).then(() => {
    const $ = window.jQuery;
    $(function() {
      let duration = 10;
      let closeEnabled = false;
      let timerStarted = false;
      let timerInterval;
      const $popupWrap = $('.popup-wrap');
      const $btnClose = $('.btn-close');
      const $seconds = $('.seconds');
      const contentVideo = document.getElementById('content-video');
      const adContainer = document.getElementById('ad-container');
      
      // IMA SDK vars
      let adDisplayContainer, adsLoader, adsManager;
      
      // Timer countdown function
      function startTimer() {
        duration--;
        $seconds.text(duration);
        if (duration <= 0) {
          clearInterval(timerInterval);
          closeEnabled = true;
          $btnClose.removeClass('disabled').css('pointer-events', 'auto');
        }
      }
      
      // IMA initialization
      function initIMA() {
        adDisplayContainer = new google.ima.AdDisplayContainer(adContainer, contentVideo);
        adDisplayContainer.initialize();
        adsLoader = new google.ima.AdsLoader(adDisplayContainer);
        adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, onAdsManagerLoaded);
        adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);
        
        const adsRequest = new google.ima.AdsRequest();
        adsRequest.adTagUrl = "https://chubby-tap.com/d/m/Fuz.d/G/NtvJZCGMUU/PeHmi9yu/ZdUIlYkOPpTPY/2/NHzuI/3/MnT/kJt/NWjSYr3DM/jdcoytMlC/ZjsNaEWY1bp/dvDb0Ox-";
        adsRequest.linearAdSlotWidth = adContainer.offsetWidth;
        adsRequest.linearAdSlotHeight = adContainer.offsetHeight;
        adsRequest.nonLinearAdSlotWidth = adContainer.offsetWidth;
        adsRequest.nonLinearAdSlotHeight = 150;
        adsLoader.requestAds(adsRequest);
      }
      
      function onAdsManagerLoaded(e) {
        adsManager = e.getAdsManager(contentVideo);
        adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);
        adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, () => contentVideo.pause());
        adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, () => contentVideo.play());
        
        try {
          adsManager.init(adContainer.offsetWidth, adContainer.offsetHeight, google.ima.ViewMode.NORMAL);
          adsManager.start();
          adContainer.style.pointerEvents = "auto";
        } catch (err) {
          console.error('Ad initialization failed', err);
          contentVideo.play();
          adContainer.style.pointerEvents = "none";
        }
      }
      
      function onAdError(event) {
        console.error('Ad error:', event.getError());
        if (adsManager) {
          try {
            adsManager.destroy();
          } catch (e) {}
        }
        contentVideo.play();
        adContainer.style.pointerEvents = "none";
      }
      
      // Show popup and start timer on load
      setTimeout(() => {
        $seconds.text(duration);
        $popupWrap.fadeIn(400);
        
        contentVideo.addEventListener('play', () => {
          if (timerStarted) return;
          timerStarted = true;
          timerInterval = setInterval(startTimer, 1000);
        });
        
        // Initialize ads when content video first plays
        contentVideo.addEventListener('play', () => {
          if (!adDisplayContainer) initIMA();
        });
        
        // Close button handler
        $btnClose.on('click', () => {
          if (!closeEnabled) {
            alert("Please watch the ad for a few seconds before closing.");
            return;
          }
          clearInterval(timerInterval);
          contentVideo.pause();
          contentVideo.currentTime = 0;
          if (adsManager) {
            try { adsManager.destroy(); } catch (e) {}
          }
          adContainer.style.pointerEvents = 'none';
          $popupWrap.fadeOut(300);
        });
        
        // Close popup on outside click if allowed
        $popupWrap.on('click', (e) => {
          if (e.target === e.currentTarget && closeEnabled) {
            clearInterval(timerInterval);
            contentVideo.pause();
            contentVideo.currentTime = 0;
            if (adsManager) {
              try { adsManager.destroy(); } catch (e) {}
            }
            adContainer.style.pointerEvents = 'none';
            $popupWrap.fadeOut(300);
          }
        });
        
      }, 1000);
    });
  }).catch(console.error);
})();
});
</script>
</html>