<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Responsive Full Page Popup with IMA Ad</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  * {margin:0; padding:0; box-sizing:border-box;}
  html,body {width:100%; height:100%; overflow-x:hidden; font-family:Arial,sans-serif; background:#111;}

  .popup-wrap {
    position:fixed;
    top:0; left:0;
    width:100vw; height:100vh;
    background:rgba(0,0,0,0.65);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
    padding:1rem;
  }

  .popup {
    position:relative;
    background:#000;
    border-radius:14px;
    width:95vw;
    max-width:900px;
    aspect-ratio:16 / 9;
    box-shadow:0 15px 50px rgba(0,0,0,0.7);
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .btn-close {
    position:absolute;
    top:12px; right:12px;
    width:32px; height:32px;
    border-radius:50%;
    background:#fff;
    color:#000;
    font-weight:bold;
    font-size:1.4rem;
    line-height:32px;
    text-align:center;
    cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,0.3);
    transition:transform .3s ease;
    z-index:20;
  }
  .btn-close:hover {transform:scale(1.1) rotate(90deg);}
  .btn-close.disabled {cursor:not-allowed; opacity:0.5; pointer-events:none;}

  .popup-timer {
    position:absolute;
    top:12px; right:60px;
    background:rgba(255,255,255,0.15);
    color:#fff;
    padding:6px 14px;
    border-radius:20px;
    font-weight:600;
    font-size:1rem;
    text-align:center;
    z-index:20;
  }

  #video-container {
    position:relative;
    width:100%;
    height:100%;
    overflow:hidden;
  }

  #content-video, #ad-container {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:contain;
  }

  #ad-container {pointer-events:none; z-index:10;}

  @media(max-width:480px){
    .popup {width:100%; border-radius:10px;}
    .btn-close {width:26px; height:26px;font-size:1.1rem;line-height:26px;right:8px;top:8px;}
    .popup-timer {font-size:.9rem;right:46px;top:8px;padding:5px 10px;}
  }
</style>
</head>
<body>

<div class="popup-wrap" role="dialog" aria-modal="true" aria-label="Advertisement Popup">
  <div class="popup">
    <div class="popup-timer"><span class="seconds"></span> sec left</div>
    <div class="btn-close disabled" aria-label="Close popup">Ã—</div>
    <div id="video-container">
      <video id="content-video" playsinline controls>
        <source src="/main_Resource/ads/video ads/The_Bread_-_Animated_Short_Film_by_GULU(360p).mp4" type="video/mp4">
      </video>
      <div id="ad-container"></div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
<script>
$(function(){
  let countdown = 10, timerInterval, started = false, closeEnabled = false;
  const $popup = $('.popup-wrap'), $seconds = $('.seconds'), $btn = $('.btn-close');
  const video = document.getElementById('content-video');

  function updateTimer(){
    countdown--; $seconds.text(countdown);
    if(countdown<=0){ clearInterval(timerInterval); $btn.removeClass('disabled'); closeEnabled=true; }
  }

  setTimeout(()=>{
    $seconds.text(countdown);
    $popup.fadeIn(400);
    video.addEventListener('play', ()=>{
      if(started) return;
      started=true; timerInterval = setInterval(updateTimer,1000);
    });
    $btn.on('click',()=>{
      if(!closeEnabled) return alert('Please wait for the timer before closing.');
      clearInterval(timerInterval); video.pause(); $popup.fadeOut(400);
    });
    $popup.on('click',e=>{
      if(e.target===e.currentTarget && closeEnabled){ clearInterval(timerInterval); video.pause(); $popup.fadeOut(400); }
    });
  },800);
});
</script>

<script>
const contentVideo=document.getElementById('content-video');
const adContainer=document.getElementById('ad-container');
const vastAdTagUrl="https://chubby-tap.com/d/m/Fuz.d/G/NtvJZCGMUU/PeHmi9yu/ZdUIlYkOPpTPY/2/NHzuI/3/MnT/kJt/NWjSYr3DM/jdcoytMlC/ZjsNaEWY1bp/dvDb0Ox-";

let adDisplayContainer, adsLoader, adsManager;

function initIMA(){
  adDisplayContainer=new google.ima.AdDisplayContainer(adContainer, contentVideo);
  adDisplayContainer.initialize();
  adsLoader=new google.ima.AdsLoader(adDisplayContainer);
  adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,onAdsManagerLoaded,false);
  adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,onAdError,false);

  const adsRequest=new google.ima.AdsRequest();
  adsRequest.adTagUrl=vastAdTagUrl;
  const box=adContainer.getBoundingClientRect();
  adsRequest.linearAdSlotWidth=box.width;
  adsRequest.linearAdSlotHeight=box.height;
  adsLoader.requestAds(adsRequest);
}

function onAdsManagerLoaded(event){
  adsManager=event.getAdsManager(contentVideo);
  adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,onAdError);
  adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,()=>contentVideo.pause());
  adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,()=>contentVideo.play());
  try{
    resizeIMA();
    adsManager.init(adContainer.clientWidth,adContainer.clientHeight,google.ima.ViewMode.NORMAL);
    adsManager.start();
  }catch(e){ console.warn('Ad start error',e); contentVideo.play(); }
}

function resizeIMA(){
  if(adsManager){
    adsManager.resize(adContainer.clientWidth,adContainer.clientHeight,google.ima.ViewMode.NORMAL);
  }
}

window.addEventListener('resize',resizeIMA);

function onAdError(e){
  console.error('IMA Error:',e.getError());
  if(adsManager) adsManager.destroy();
  contentVideo.play();
}

contentVideo.addEventListener('play',()=>{ if(!adDisplayContainer) initIMA(); });
</script>

</body>
</html>